"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.compilers = void 0;
var code_compiler_1 = require("./code-compiler");
var babel = require("@babel/core");
var definition_compiler_1 = require("./definition-compiler");
var compilers = function (_a) {
    var code = _a.code, definition = _a.definition, extensionName = _a.extensionName;
    var compile2Code = (0, code_compiler_1.codeCompiler)(code);
    var compile2Defition = (0, definition_compiler_1.definitionCompiler)(definition);
    return function (_a) {
        var _b;
        var module = _a.module, fileUrl = _a.fileUrl, includes = _a.includes, config = _a.config, targetOptions = _a.targetOptions;
        var _c = compile2Code(module, fileUrl, config, targetOptions, includes), code = _c.code, map = _c.map;
        var outputCode = code;
        if (targetOptions.es5) {
            outputCode = babel.transformSync(code, { presets: ["@babel/preset-env"] })
                .code;
        }
        var ext = typeof extensionName == "function"
            ? extensionName(targetOptions)
            : extensionName;
        return _b = {},
            _b["." + ext] = outputCode,
            _b["." + ext + ".map"] = map.toString(),
            _b[".d.ts"] = compile2Defition(module, fileUrl, config, targetOptions),
            _b;
    };
};
exports.compilers = compilers;
